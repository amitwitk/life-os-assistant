# 2.2 Event Writer
Status: - [ ] Not Started

## Description
Create the Google Calendar write service. This is the **write-side of the Capture System** â€” it takes a `ParsedEvent` from the LLM parser and creates the corresponding Google Calendar event.

## Files to Create/Edit
- [ ] `src/integrations/gcal_service.py`

## Prompt for Claude
```
You are building **LifeOS Assistant**. This module is the **write-side of the Capture System**. After the LLM parser (`1.2`) extracts structured event data from the user's message, this module writes it to Google Calendar. It consumes the `ParsedEvent` JSON contract.

The Google auth module exists at `src/integrations/google_auth.py` with a `get_calendar_service()` function. The parser module at `src/core/parser.py` defines a `ParsedEvent` Pydantic model.

The **ParsedEvent JSON contract** (defined in `1.2`, consumed here and in `3.3`):
```json
{
  "event": "Dentist appointment",
  "date": "2025-02-14",
  "time": "16:00",
  "duration_minutes": 60,
  "description": ""
}
```

Create `src/integrations/gcal_service.py` with the following:

1. Create an async function `add_event(parsed_event: ParsedEvent) -> dict`:
   - Get the calendar service via `get_calendar_service()`.
   - Build a Google Calendar event body from the ParsedEvent:
     - summary = parsed_event.event
     - description = parsed_event.description
     - start.dateTime = combine parsed_event.date and parsed_event.time into ISO 8601 format with timezone (use Asia/Jerusalem).
     - end.dateTime = start + parsed_event.duration_minutes.
   - Insert the event using `service.events().insert(calendarId='primary', body=event_body).execute()`.
   - Return the created event dict (contains 'htmlLink', 'id', etc.).
   - Log the result.

2. Create a helper function `_build_event_body(parsed_event: ParsedEvent) -> dict` that constructs the Google Calendar API event body.

3. Handle errors gracefully:
   - If the Google API call fails, log the error and raise a custom `CalendarError` exception.
   - Define `CalendarError` as a simple Exception subclass in this module.

4. Include proper logging and type hints throughout.
```
