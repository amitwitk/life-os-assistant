# 3.2 Voice Message Handling
Status: - [x] Completed

## Description
Add voice message support to the Telegram bot using OpenAI's Whisper API for speech-to-text transcription. Voice is the fastest capture method â€” a core part of the Capture System. This is the **only module that uses the OpenAI SDK**.

## Files to Create/Edit
- [ ] `src/core/transcriber.py` (new)
- [ ] `src/bot/telegram_bot.py` (update existing)

## Prompt for Claude
```
You are building **LifeOS Assistant**. Voice is the **fastest capture method** â€” speaking a quick message is faster than typing. This makes voice support a core part of the Capture System pillar. After transcription, the text flows into the same Claude parser as typed messages.

IMPORTANT: This is the **only module in the entire project that uses the OpenAI SDK**. OpenAI is used here exclusively for Whisper audio transcription. All other LLM calls (parsing, summarization) use the Anthropic SDK.

The Telegram bot exists at `src/bot/telegram_bot.py` with basic text handling. The config module at `src/config.py` has `OPENAI_API_KEY`.

Perform the following:

1. Create `src/core/transcriber.py`:
   - Create an async function `transcribe_audio(file_path: str) -> str`:
     - Use the OpenAI Whisper API (`client.audio.transcriptions.create`).
     - Model: "whisper-1".
     - Pass `language="he"` as a hint for Hebrew (Whisper handles mixed Hebrew/English well with this hint).
     - Open the audio file and send it for transcription.
     - Return the transcribed text.
     - Handle errors gracefully with logging.
   - Use `from src.config import settings` for the API key (`settings.OPENAI_API_KEY`).

2. Update `src/bot/telegram_bot.py`:
   - Add a voice message handler that:
     a. Downloads the voice message OGG file to a temp directory.
     b. Calls `transcribe_audio()` to get the text.
     c. Sends the transcribed text back to the user with a prefix: "ðŸŽ¤ I heard: [transcribed text]".
     d. Cleans up the temp file after processing.
   - Register the voice handler in `build_app()`.
   - The voice handler must also respect the security filter (silently ignore unauthorized users).

3. Use `tempfile` for temporary file management and ensure cleanup happens even on errors (use try/finally).

4. Include proper logging throughout.

Do NOT remove or modify existing handlers. Only ADD the voice handling capability.
```

## Implementation Logs
- **Commit:** `7535c7d` â€” feat(telegram): 3.2 Voice Handling
- **Files created:**
  - `src/core/transcriber.py` â€” `transcribe_audio()` using OpenAI Whisper with Hebrew hint
- **Files updated:**
  - `src/bot/telegram_bot.py` â€” Added `handle_voice()` handler with temp file cleanup
