# 4.2 Scheduler - Morning Briefing
Status: - [ ] Not Started

## Description
Set up the daily Morning Briefing — a proactive push at **08:00 Asia/Jerusalem** that summarizes today's calendar events and due chores using Claude, then sends the result via Telegram. This is the **Morning Briefing pillar**: the user starts their day with a friendly, LLM-written summary without needing to ask.

## Files to Create/Edit
- [ ] `src/core/scheduler.py`
- [ ] `src/bot/telegram_bot.py` (update to integrate scheduler)
- [ ] `main.py` (update to start scheduler)

## Prompt for Claude
```
You are building **LifeOS Assistant**. This module implements the **Morning Briefing pillar** — a proactive daily push at 08:00 Asia/Jerusalem. The user shouldn't need to ask "what's on today?" — LifeOS tells them. The summary is written by Claude (not raw text), making it friendly and natural.

The following modules exist:
- `src/bot/telegram_bot.py`: Telegram bot with full event handling.
- `src/integrations/gcal_service.py`: `get_daily_events() -> list[dict]` (returns structured event data).
- `src/data/db.py`: `ChoreDB` class with `get_due_chores() -> list[Chore]`.
- `src/config.py`: `settings` with `TELEGRAM_BOT_TOKEN`, `ALLOWED_USER_IDS`, `ANTHROPIC_API_KEY`, `MORNING_BRIEFING_HOUR` (default 8), `TIMEZONE` (default "Asia/Jerusalem").

Perform the following:

1. Create `src/core/scheduler.py`:
   - Create an async function `send_morning_summary(bot, chat_id: int)`:
     a. Get today's calendar events via `get_daily_events()`.
     b. Get due chores via `ChoreDB().get_due_chores()`.
     c. Build a raw data string from calendar events and chores.
     d. **Use the Anthropic SDK** to call Claude (claude-haiku-4-5-20251001) with a prompt like:
        "You are a friendly personal assistant. Summarize the following calendar events and chores into a warm, concise morning briefing in Hebrew. If there are no events or chores, say so cheerfully."
     e. Send the Claude-generated summary via `bot.send_message(chat_id=chat_id, text=summary)`.
     f. **Graceful degradation**: If the Calendar API fails, still send chores. If the DB fails, still send calendar events. If both fail, send a fallback message. If Claude fails, fall back to raw text formatting.

   - Create a function `setup_scheduler(app: Application)`:
     - Use `python-telegram-bot`'s built-in `JobQueue`.
     - Schedule `send_morning_summary` to run daily at **08:00** in the timezone from `settings.TIMEZONE` (default Asia/Jerusalem).
     - Send to all user IDs in `settings.ALLOWED_USER_IDS`.

2. Update `src/bot/telegram_bot.py`:
   - In `build_app()`, call `setup_scheduler(app)` after registering handlers.

3. Update `main.py` if needed to ensure the scheduler starts with the bot.

4. Include proper logging throughout. Log when the morning briefing is sent and to whom.

IMPORTANT: Use the **Anthropic SDK** (`anthropic.AsyncAnthropic`) for the summary generation, NOT OpenAI. The only OpenAI usage in the entire project is Whisper transcription in `3.2`.
```
